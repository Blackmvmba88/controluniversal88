<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400" width="800" height="400">
  <!-- Define styles -->
  <defs>
    <style>
      .component { fill: #2d3748; stroke: #4a5568; stroke-width: 2; rx: 8; }
      .component-alt { fill: #1a365d; stroke: #2c5282; stroke-width: 2; rx: 8; }
      .highlight { fill: #2d5a8f; stroke: #3182ce; stroke-width: 2; rx: 8; }
      .text { fill: #e2e8f0; font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; text-anchor: middle; }
      .text-small { fill: #cbd5e0; font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; text-anchor: middle; }
      .arrow { stroke: #63b3ed; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-data { stroke: #48bb78; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); stroke-dasharray: 5,5; }
      .title { fill: #f7fafc; font-family: 'Segoe UI', Arial, sans-serif; font-size: 20px; font-weight: bold; text-anchor: middle; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#63b3ed" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#48bb78" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#1a202c"/>
  
  <!-- Title -->
  <text x="400" y="30" class="title">ControlUniversal System Architecture</text>
  
  <!-- DualShock 4 Controller -->
  <rect x="50" y="160" width="120" height="80" class="component"/>
  <text x="110" y="195" class="text">üéÆ DualShock 4</text>
  <text x="110" y="215" class="text-small">(USB/HID)</text>

  <!-- Backend Layer -->
  <g>
    <!-- Node.js Backend -->
    <rect x="250" y="80" width="140" height="70" class="highlight"/>
    <text x="320" y="110" class="text">Node.js Backend</text>
    <text x="320" y="128" class="text-small">daemon.js</text>
    <text x="320" y="142" class="text-small">server.js</text>
    
    <!-- Python Backend -->
    <rect x="250" y="230" width="140" height="70" class="component-alt"/>
    <text x="320" y="260" class="text">Python Backend</text>
    <text x="320" y="278" class="text-small">daemon.py</text>
    <text x="320" y="292" class="text-small">server.py (FastAPI)</text>
  </g>

  <!-- WebSocket -->
  <ellipse cx="500" cy="200" rx="60" ry="40" class="highlight"/>
  <text x="500" y="200" class="text">WebSocket</text>
  <text x="500" y="215" class="text-small">Events</text>

  <!-- WebUI -->
  <rect x="620" y="160" width="130" height="80" class="component"/>
  <text x="685" y="195" class="text">üåê WebUI</text>
  <text x="685" y="215" class="text-small">SVG Visualization</text>

  <!-- Mapping/Calibration -->
  <rect x="480" y="320" width="140" height="60" class="component-alt"/>
  <text x="550" y="345" class="text">Mapping &amp;</text>
  <text x="550" y="363" class="text-small">Calibration Tools</text>

  <!-- Arrows: Controller to Backends -->
  <path d="M 170 200 L 250 125" class="arrow"/>
  <path d="M 170 200 L 250 265" class="arrow"/>
  
  <!-- Arrows: Backends to WebSocket -->
  <path d="M 390 115 L 450 185" class="arrow"/>
  <path d="M 390 265 L 450 215" class="arrow"/>
  
  <!-- Arrow: WebSocket to WebUI -->
  <path d="M 560 200 L 620 200" class="arrow-data"/>
  
  <!-- Arrow: Mapping to Backend -->
  <path d="M 550 320 L 400 280" class="arrow-data"/>
  <path d="M 550 320 L 340 150" class="arrow-data"/>

  <!-- Labels for data flow -->
  <text x="200" y="145" class="text-small" style="fill: #90cdf4;">HID Reports</text>
  <text x="420" y="170" class="text-small" style="fill: #90cdf4;">Parse</text>
  <text x="590" y="185" class="text-small" style="fill: #68d391;">JSON Events</text>
  <text x="460" y="305" class="text-small" style="fill: #68d391;">.ds4map.json</text>

  <!-- Simulation Mode Badge -->
  <rect x="50" y="100" width="120" height="30" fill="#48bb78" stroke="#38a169" stroke-width="1" rx="5"/>
  <text x="110" y="120" class="text-small" style="fill: white;">SIMULATE=1 Mode</text>

  <!-- Legend -->
  <g transform="translate(50, 340)">
    <text x="0" y="0" class="text-small" style="text-anchor: start; fill: #a0aec0;">Legend:</text>
    <line x1="0" y1="10" x2="30" y2="10" class="arrow"/>
    <text x="35" y="14" class="text-small" style="text-anchor: start;">Control Flow</text>
    <line x1="0" y1="25" x2="30" y2="25" class="arrow-data"/>
    <text x="35" y="29" class="text-small" style="text-anchor: start;">Data/Config</text>
  </g>
</svg>
